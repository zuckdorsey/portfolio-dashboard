---
// FormModal.astro - Reusable modal form component
interface Props {
  id: string;
  title: string;
  fields: Array<{
    name: string;
    label: string;
    type: "text" | "textarea" | "date" | "url" | "email" | "number" | "select";
    required?: boolean;
    placeholder?: string;
    options?: Array<{ value: string; label: string }>;
  }>;
  submitText?: string;
  onSubmit?: string;
}

const {
  id,
  title,
  fields,
  submitText = "Simpan",
  onSubmit = "handleSubmit",
} = Astro.props as Props;
---

<div
  id={id}
  class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
>
  <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4">
    <!-- Header -->
    <div class="flex items-center justify-between p-6 border-b border-gray-200">
      <h3 class="text-xl font-semibold text-gray-900 modal-title">{title}</h3>
      <button
        type="button"
        onclick={`closeModal('${id}')`}
        class="text-gray-400 hover:text-gray-600"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Form -->
    <form id={`${id}-form`} class="p-6 space-y-4">
      {
        fields.map((field) => (
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              {field.label}
              {field.required && <span class="text-red-500">*</span>}
            </label>

            {field.type === "textarea" ? (
              <textarea
                name={field.name}
                placeholder={field.placeholder}
                required={field.required}
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                rows="4"
              />
            ) : field.type === "select" ? (
              <select
                name={field.name}
                required={field.required}
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              >
                <option value="">Pilih {field.label.toLowerCase()}</option>
                {field.options?.map((opt) => (
                  <option value={opt.value}>{opt.label}</option>
                ))}
              </select>
            ) : (
              <input
                type={field.type}
                name={field.name}
                placeholder={field.placeholder}
                required={field.required}
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              />
            )}
          </div>
        ))
      }

      <!-- Hidden ID field for edit mode -->
      <input type="hidden" name="id" value="" />
    </form>

    <!-- Footer -->
    <div class="flex gap-3 justify-end p-6 border-t border-gray-200">
      <button
        type="button"
        onclick={`closeModal('${id}')`}
        class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50"
      >
        Batal
      </button>
      <button
        type="button"
        onclick={`${onSubmit}('${id}')`}
        class="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700"
      >
        {submitText}
      </button>
    </div>
  </div>
</div>

<script>
  // Global functions
  window.openModal = (modalId: string) => {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.remove("hidden");
    }
  };

  window.closeModal = (modalId: string) => {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.add("hidden");
      const form = document.getElementById(
        `${modalId}-form`,
      ) as HTMLFormElement;
      if (form) form.reset();
    }
  };

  // Close modal on background click
  document.addEventListener("click", (e: MouseEvent) => {
    const target = e.target as HTMLElement;
    if (
      target.classList.contains("fixed") &&
      target.classList.contains("z-50")
    ) {
      const modalId = target.id;
      window.closeModal(modalId);
    }
  });
</script>
